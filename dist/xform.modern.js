/*!
 * xform.modern v0.4.4 (https://github.com/dongls/xForm)
 * Copyright 2019 dongls
 * Released under the MIT License
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("xform.modern",[],t):"object"==typeof exports?exports["xform.modern"]=t():e["xform.modern"]=t()}(window,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=3)}([,function(e,t,r){"use strict";function i(){return(i=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}var n=["attrs","props","domProps"],l=["class","style","directives"],o=["on","nativeOn"],s=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}};e.exports=function(e){return e.reduce((function(e,t){for(var r in t)if(e[r])if(-1!==n.indexOf(r))e[r]=i({},e[r],t[r]);else if(-1!==l.indexOf(r)){var a=e[r]instanceof Array?e[r]:[e[r]],d=t[r]instanceof Array?t[r]:[t[r]];e[r]=a.concat(d)}else if(-1!==o.indexOf(r))for(var f in t[r])if(e[r][f]){var u=e[r][f]instanceof Array?e[r][f]:[e[r][f]],c=t[r][f]instanceof Array?t[r][f]:[t[r][f]];e[r][f]=u.concat(c)}else e[r][f]=t[r][f];else if("hook"==r)for(var p in t[r])e[r][p]=e[r][p]?s(e[r][p],t[r][p]):t[r][p];else e[r]=t[r];else e[r]=t[r];return e}),{})}},,function(e,t,r){"use strict";function i(e){if(null==e)return"";var t=e.required?"select"==e.type?"[必选] ":"[必填] ":"",r=e.placeholder||"";return"".concat(t).concat(r)||null}function n(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["xform-designer","xform-builder","xform-viewer"];if(null==e)return null;for(var i=e.$root,n=e.$parent;null!=n&&n!=i;){if(n.$options.name==t)return n;if(r.indexOf(n.$options.name)>=0)return null;n=n.$parent}return null}r.r(t);var l={RegExp:"[object RegExp]"};function o(e){return null==e||"string"==typeof e&&0==e.length}function s(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(s);var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=e[r];t[r]=null==i||"object"!=typeof e?i:s(i)}return t}function a(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&null!=t[r]){var i=t[r];if("object"!=typeof i||Array.isArray(i))e[r]=i;else{var n=e[r];e[r]=a("object"!=typeof n?{}:n,i)}}return e}function d(e,t){if(null==t||""==t)return null;for(var r=e,i=t.split("."),n=0;n<i.length;n++){var l=i[n];if(null==r[l])return null;r=r[l]}return r}class f{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type=e.type,this.title=e.title,this.icon=e.icon,this.custom=!0===e.custom,this.attributes=e.attributes,this.component=e.component||{},this.extension=e.extension||{},this.validator=e.validator}get available(){return null!=this.type}}var u={config:s({icons:{designerRemove:"",designerCopy:"",builderHelp:""},modes:{},label:{position:"left",width:null},designer:{label:{position:"left",width:null}},builder:{label:{position:"left",width:null}},viewer:{label:{position:"left",width:null}},validator:{immediate:!0},formatter:(e,t)=>t[e.name]}),types:{}};function c(){var e=s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});u.config=function(){if(arguments.length<2)return arguments.length<=0?void 0:arguments[0];for(var e=arguments.length<=0?void 0:arguments[0],t=1;t<arguments.length;t++)e=a(e,t<0||arguments.length<=t?void 0:arguments[t]);return e}(u.config,e)}function p(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.length<=0||t.reduce((e,t)=>(Array.isArray(t)?e=e.concat(t):e.push(t))&&e,[]).map(e=>new f(e)).filter(e=>e.available).forEach(e=>{u.types[e.type]=e})}var v={use:function(e){c(e.config),p(Object.keys(e.types).map(t=>e.types[t]))},register:p,setConfig:c,findConfigProp:function(){for(var e=0;e<arguments.length;e++){var t=e<0||arguments.length<=e?void 0:arguments[e],r=d(u.config,t);if(null!=r)return r}return null},findFieldType:function(e){return u.types[e]},findFieldTypes:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.reduce((e,t)=>(Array.isArray(t)?e=e.concat(t):e.push(t))&&e,[]).filter(e=>null!=e);return 0==i.length&&(i=Object.keys(u.types)),i.map(e=>u.types[e]).filter(e=>null!=e)},findMode:function(e){var t=d(u.config,"modes.".concat(e));return Array.isArray(t)?t.filter(e=>null!=e):[]}},m={validate:{bind(e,t,r){var i=r.context,l=n(r.componentInstance,"xform-item"),o=("object"==typeof t.value?t.value:{key:t.value}).key||i.field&&i.field.name;null!=l&&null!=o&&(l.$emit("xform.builder.field.add",{key:o,context:i}),v.findConfigProp("validator.immediate")&&i.$watch("value",()=>l.$emit("xform.builder.validate"),{deep:!0}),i.__xform_directive_validate_key__=o,i.__xform_directive_xform_item_instance__=l)},unbind(e,t,r){var i=r.context,n=i.__xform_directive_validate_key__,l=i.__xform_directive_xform_item_instance__;null!=n&&null!=l&&l.$emit("xform.builder.field.remove",{key:n})}}},h={bind(e,t,r){var i=t.arg,n=m[i];return null==n?null:n.bind(e,t,r)},unbind(e,t,r){var i=t.arg,n=m[i];return null==n?null:n.unbind(e,t,r)}},g={beforeCreate(){var e=this.$options.static;if("function"==typeof e){var t=e.call(this);this.$static=Object.assign(this.$static||{},t)}}};class y{constructor(e){this.type=e.type,this.name=e.name||"field_".concat(Math.random().toString(16).slice(-8)),this.title=e.title,this.placeholder=e.placeholder,this.help=e.help,this.defaultValue=e.defaultValue,this.required=!0===e.required,this.options=function(e){if(["select","checkbox","radio"].indexOf(e.type)<0)return[];var t=Array.isArray(e.options)?e.options:[];return 0==t.length&&t.push({value:"选项1"}),t}(e),this.attributes="function"==typeof e.attributes?e.attributes():e.attributes||{},this.designer={dragging:!1},Object.defineProperty(this,"_exclude_props",{enumerable:!1,value:["designer","storage"]}),Object.defineProperty(this,"_storage",{enumerable:!1,value:{fieldType:null}})}toJSON(){for(var e=this._exclude_props||[],t=Object.keys(this).filter(t=>e.indexOf(t)<0),r={},i=0;i<t.length;i++){var n=t[i];r[n]=this[n]}return r}findFieldType(){if(null==this.type)return null;var e=this._storage;if(e.fieldType instanceof f)return e.fieldType;var t=v.findFieldType(this.type);return null!=t&&(e.fieldType=t),t}copy(){var e=JSON.parse(JSON.stringify(this));return delete e.name,new y(e)}}var x={nonReactive:g,setting:{props:{field:{type:y,default:null}},methods:{updateProp(e){var t=e.target,r=t.tagName.toLowerCase(),i=t.dataset.prop,n=t.value;"input"==r&&"checkbox"==t.type&&(n=t.checked),this.update(i,n)},updateAttrs(e,t){if(null!=this.field){var r=this.field.attributes;this.$set(r,e,t),this.update("attributes",r)}},update(e,t){this.$emit("update",{prop:e,value:t})}}},builder:{props:{field:{type:y,default:null,required:!0},placeholder:{type:String,default:null}},computed:{prettyPlaceholder(){return this.placeholder?this.placeholder:i(this.field)}},methods:{input(e){this.$emit("input",e)}}},preview:{props:{field:{type:y,default:null},placeholder:{type:String,default:null}},computed:{prettyPlaceholder(){return this.placeholder?this.placeholder:i(this.field)}}}},b={XField:y,XFieldType:f},w=r(1),A=r.n(w);var P=[".xform-designer-mark",".xform-droppable",".xform-designer-list",".xform-designer-zone"],F={name:"xform-designer",mixins:[g],props:{value:{type:Array,default:()=>[]},mode:{type:String,default:null}},static:()=>({dragEvent:null}),data:()=>({selectedField:null}),computed:{isEmpty(){return!Array.isArray(this.value)||0==this.value.length},icons:()=>v.findConfigProp("icons")},methods:{showSelected(){var e=this.$refs.scroll,t=this.$refs.list.querySelector(".xform-is-selected");(function(e,t){return e.offsetTop<t.scrollTop||e.offsetTop>t.scrollTop+t.offsetHeight})(t,e)&&(e.scrollTop=t.offsetTop)},scroll(e){var{pixelY:t}=function(e){var{deltaX:t,deltaY:r}=e,i=0==e.deltaMode?1:1==e.deltaMode?40:800;return{pixelX:t*i,pixelY:r*i}}(e);this.$refs.scroll.scrollTop+=t},chooseField(e){this.selectedField=e,this.$nextTick(this.showSelected)},copy(e,t){var r=t.copy(),i=this.value.indexOf(t);this.value.splice(i+1,0,r),this.$emit("input",this.value),this.chooseField(r)},remove(e,t){if(confirm("该字段删除后不可恢复，是否继续？")){var r=this.value.findIndex(e=>e==t);r>=0&&(this.selectedField=null,this.value.splice(r,1),this.$emit("input",this.value))}},insert(e){var t=this.$static.dragEvent,r=new y(t.target._xform_field_type);return this.value.splice(e,0,r),this.$emit("input",this.value),r},sort(e,t){if(!(e<0||t<0||e==t)){var r=this.value,i=r.splice(e,1)[0];r.splice(t>e?t-1:t,0,i),this.$emit("input",r)}},dragstart(e){if(0===e.button){var t=this.createDragEvent(e);this.$static.dragEvent=t,document.addEventListener("mousemove",this.dragging),document.addEventListener("mouseup",this.dragend)}},dragging(e){var t=this.$static.dragEvent,r=this.$refs.ghost;t.init||(this.$refs.list.classList.add("xform-designer-silence"),r.querySelector(".xform-designer-ghost-template").innerHTML=this.createGhostTemplate(t),r.style.display="block","sort"==t.mode&&t.target.classList.add("xform-is-dragging"),t.init=!0);var i=e.clientX-t.offsetLeft,n=e.clientY-t.offsetTop;if(r.style.transform="translate(".concat(i,"px, ").concat(n,"px)"),!(Math.abs(e.clientY-t.prevY)<2)){var l=e.clientY-t.prevY<0?"up":"down";t.prevY=e.clientY;var o=this.$refs.mark,s=this.$refs.list,a=this.$refs.zone,d=function(e,t,r){var i=document.elementsFromPoint||document.msElementsFromPoint;if("function"!=typeof i)return null;var n=i.call(document,e,t);if(null==n)return null;for(var l=Array.isArray(n)?n:Array.prototype.slice.call(n),o=function(e){var t=l[e];if(r.some(e=>t.matches(e)))return{v:t}},s=0;s<l.length;s++){var a=o(s);if("object"==typeof a)return a.v}return null}(e.clientX,e.clientY,P);if(null==d)return a.appendChild(o),r.classList.add("xform-designer-not-allowed");if(r.classList.remove("xform-designer-not-allowed"),d==a)return!s.contains(o)&&s.appendChild(o);if(d!=s){var f="up"==l?d:d.nextElementSibling;f==o||null!=f&&f.previousElementSibling==o||s.insertBefore(o,f)}}},dragend(e){var t=this.$static.dragEvent,r="insert"!=t.mode||t.init?Array.from(this.$refs.list.children).findIndex(e=>e==this.$refs.mark):this.value.length;if(r>=0){if("sort"==t.mode){var i=t.target._xform_field,n=this.value.indexOf(i);this.sort(n,r),this.chooseField(i)}if("insert"==t.mode){var l=this.insert(r);this.chooseField(l)}}t.target.classList.remove("xform-is-dragging"),this.$refs.list.classList.remove("xform-designer-silence"),this.$refs.zone.appendChild(this.$refs.mark),this.$refs.ghost.style.display="none",this.$static.dragEvent=null,document.removeEventListener("mousemove",this.dragging),document.removeEventListener("mouseup",this.dragend)},createGhostTemplate(e){var t=e.target;if("insert"==e.mode)return t.matches(".xform-template")?t.outerHTML:t.querySelector(".xform-template").outerHTML;var r=t._xform_field,i=r.findFieldType(),n=this.$el.querySelector('.xform-designer-field-type[data-field-type="'.concat(i.type,'"]')),l=null;if(null!==n){var o=n.querySelector(".xform-icon");null!=o&&(l=o.outerHTML)}return'\n        <div class="xform-designer-field-type">\n          <strong>'.concat(r.title,"</strong>\n          ").concat(l,"\n        </div>\n      ")},createDragEvent(e){var t=e.target.closest(".xform-draggable"),r=t._xform_mode,i=t.getBoundingClientRect();return{init:!1,mode:r,target:t,prevY:e.clientY,offsetLeft:"insert"==r?e.clientX-i.left:72,offsetTop:"insert"==r?e.clientY-i.top:17}},renderFieldPreview(e){var t=this.$createElement,r=e.findFieldType(),i=this.createComponent("preview",e,{props:{field:e}}),n={"xform-designer-preview":!0,"xform-draggable":!0,"xform-droppable":!0,"xform-is-selected":this.selectedField==e},l={_xform_field:e,_xform_mode:"sort"};return t("div",A()([{class:n},{domProps:l},{key:e.name}]),[r&&r.custom?i:t("xform-item",{class:"xform-template",attrs:{field:e,validation:!1,behavior:"designer","label-position":v.findConfigProp("designer.label.position"),"label-width":v.findConfigProp("designer.label.width")}},[i]),t("div",{class:"xform-designer-operate"},[t("button",{attrs:{type:"button",title:"复制"},on:{click:t=>this.copy(t,e)}},[t("i",{class:this.icons.designerCopy})]),t("button",{attrs:{type:"button",title:"删除"},on:{click:t=>this.remove(t,e)}},[t("i",{class:this.icons.designerRemove})])]),t("div",{class:"xform-designer-cover",on:{mousedown:this.dragstart,click:()=>this.chooseField(e)}})])},renderPreview(){var e=this.$createElement;return e("div",{class:"xform-designer-zone",ref:"zone"},[e("div",{class:"xform-designer-list",ref:"list"},[this.value.map(this.renderFieldPreview)]),e("div",{class:"xform-designer-mark",ref:"mark",key:"xform-mark"}),this.isEmpty&&e("div",{class:"xform-designer-preview-tip"},[e("img",{attrs:{src:"data:image/png;base64,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"}}),e("p",["请将左侧控件拖动到此处"])])])},renderSetting(){var e=this.$createElement;if(null==this.selectedField)return e("div",{class:"xform-setting-tip"},["点击字段设置属性"]);var t=this.selectedField,r={field:t},i={update:e=>{t[e.prop]=e.value,this.$emit("input",this.value)}};return this.createComponent("setting",t,{props:r,on:i})},createComponent(e,t,r){var i="type_".concat(t.type,"_").concat(e);if(this.$scopedSlots[i])return this.$scopedSlots[i]({field:t});var n=t.findFieldType();if(null==n)return console.warn("[xform]: ".concat(t.title,"(").concat(t.type,") not implement")),null;var l=n.extension["".concat(this.mode,"_").concat(e)]||n.component[e];return this.$createElement(l,r)},renderFieldType(e){var t=this.$createElement,r={_xform_field_type:e,_xform_mode:"insert"},i="function"==typeof e.icon?e.icon(this.$createElement):t("i",{class:[e.icon,"xform-icon"]});return t("div",{class:"xform-designer-field-type-wrap"},[t("div",A()([{class:"xform-designer-field-type xform-draggable xform-template"},{domProps:r},{on:{mousedown:this.dragstart},attrs:{"data-field-type":e.type}}]),[t("strong",[e.title]),i])])},renderFieldTypePanel(){var e=this.$createElement,t=v.findMode(this.mode);return 0!=t.length&&"object"==typeof t[0]||(t=[{types:t}]),t.map(t=>{var r=t.group?e("h3",[t.group]):null,i=v.findFieldTypes(t.types);return e("div",{class:"xform-designer-field-type-group"},[r,e("div",{class:"xform-designer-field-types"},[i.map(this.renderFieldType)])])})}},render(){var e=arguments[0];return e("div",{class:"xform-designer"},[e("div",{class:"xform-designer-panel"},[this.renderFieldTypePanel()]),e("div",{class:"xform-designer-main"},[this.$slots.tool,e("div",{class:"xform-designer-scroll",ref:"scroll"},[this.renderPreview()])]),e("div",{class:"xform-designer-setting"},[this.renderSetting()]),e("div",{class:"xform-designer-ghost",ref:"ghost",key:"xform-ghost",on:{wheel:this.scroll}},[e("div",{class:"xform-designer-ghost-template"}),e("div",{class:"xform-designer-cover"})])])}},E={name:"xform-builder",mixins:[g],props:{fields:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})},mode:{type:String,default:null},tag:{type:String,default:"form"}},static:()=>({validators:{}}),data:()=>({pending:!1}),methods:{validate(){if(this.pending)return Promise.reject("[xform error]: validate pending...");this.pending=!0;var e=this.$static.validators,t=Object.keys(e).map(t=>e[t]());return Promise.all(t).then((function(e){return{messages:e,status:e.every(e=>!0===e)}})).catch(e=>{console.error("[xform error]: ",e)}).finally(()=>{this.pending=!1})},addField(e){var{key:t,validate:r}=e;this.$static.validators[t]=r},removeField(e){var{key:t}=e;delete this.$static.validators[t]},fillDefaultValue:(e,t)=>null==e?{}:(t.forEach(t=>{var r=t.name,i=e[r];"select"==t.type&&(!0!==t.attributes.multiple&&Array.isArray(i)&&(i=i[0]),1!=t.attributes.multiple||Array.isArray(i)||null==i||(i=[i])),null!=i||o(t.defaultValue)||(i=t.defaultValue),e[r]=i}),e),renderFormItem(e){var t=this.$createElement,r=this.createComponent(e),i=e.findFieldType();return i&&i.custom?r:t("xform-item",{attrs:{field:e,"label-position":v.findConfigProp("builder.label.position"),"label-width":v.findConfigProp("builder.label.width")},key:e.name},[r])},createComponent(e){var t="name_".concat(e.name);if(this.$scopedSlots[t])return this.$scopedSlots[t]({field:e});var r="type_".concat(e.type);if(this.$scopedSlots[r])return this.$scopedSlots[r]({field:e});var i=e.findFieldType();if(null==i)return console.warn("[xform]: ".concat(e.title,"(").concat(e.type,") not implement"));var n={field:e,value:this.value[e.name]},l={input:t=>{this.$set(this.value,e.name,t),this.$emit("input",this.value)}},o=i.extension["".concat(this.mode,"_builder")]||i.component.builder;return null==o?null:this.$createElement(o,{props:n,on:l})},buildBuilderData(e){var t=null;return"form"==e&&(t={submit:e=>{e.preventDefault(),this.validate().then(e=>{e.status&&this.$emit("submit")})}}),{class:"xform-builder",on:t}}},render(e){var t=(this.tag||"form").toLowerCase(),r=this.buildBuilderData(t),i=e("div",{class:"xform-builder-main"},[this.$slots.top,this.fields.map(this.renderFormItem),this.$slots.bottom]);return e(t,r,[i])},created(){var e=this.fillDefaultValue(this.value,this.fields);this.$emit("input",e),this.$on("xform.builder.field.add",this.addField),this.$on("xform.builder.field.remove",this.removeField)},destroyed(){this.$off("xform.builder.field.add",this.addField),this.$off("xform.builder.field.remove",this.removeField)}},O={name:"xform-viewer",props:{fields:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})},formatter:{type:Function,default(e,t){return v.findConfigProp("viewer.formatter","formatter").call(this,e,t)}},labelWidth:{type:String,default:()=>v.findConfigProp("viewer.label.width","label.width")},labelPosition:{type:String,default(){var e=["left","right","top"],t=v.findConfigProp("viewer.label.position","label.position");return e.indexOf(t)>=0?t:e[0]}},mode:{type:String,default:null}},methods:{renderItem(e){var t=this.$createElement;if(!1===e.attributes.viewer)return null;var r=this.createComponent(e),i=e.findFieldType();return i&&i.custom?r:t("xform-item",{attrs:{field:e,validation:!1,behavior:"viewer","label-position":v.findConfigProp("viewer.label.position"),"label-width":v.findConfigProp("viewer.label.width")}},[r])},createComponent(e){var t=this.formatter(e,this.value),r={field:e,value:t,model:this.value},i="name_".concat(e.name);if(this.$scopedSlots[i])return this.$scopedSlots[i](r);var n="type_".concat(e.type);if(this.$scopedSlots[n])return this.$scopedSlots[n](r);var l=e.findFieldType();if(null==l)return console.warn("[xform]: ".concat(e.title,"(").concat(e.type,") not implement")),null;var o=l.extension["".concat(this.mode,"_viewer")]||l.component.viewer;return null!=o?this.$createElement(o,{props:r}):Array.isArray(t)?t.join(", "):t}},render(){var e=arguments[0];return e("div",{class:"xform-viewer"},[e("div",{class:"xform-viewer-main"},[this.fields.map(this.renderItem)])])}};function k(e,t,r){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var n=S(e[i],t,r);if(null!=n)return Promise.reject(n)}return Promise.resolve()}function S(e,t,r){if(!0!==t.required&&o(r))return null;if("function"==typeof e.test)return e.test(r,t);if(null!=e.type){var i=function(e,t){if(null==t)return null;if(e.type!=typeof t)return"格式有误，请检查";return null}(e,r);if(null!==i)return e.message||i}if(function(e){return function(e){return null!=e&&("object"==typeof e||"function"==typeof e)}(e)&&Object.prototype.toString.call(e)==l.RegExp}(e.pattern)&&!e.pattern.test(r))return e.message||"格式有误，请检查";var n=function(e,t){if(e.length>0&&t.length!=e.length)return"长度需要为".concat(e.length,"个字符");if(null==t||0==t.toString().length||t.length<e.min||t.length>e.max)return function(e){if(e.min>0&&e.max>0&&e.max>e.min)return"长度在".concat(e.min,"~").concat(e.max,"个字符之间");if(e.min>0)return"至少".concat(e.min,"个字符");if(e.max>0)return"最多".concat(e.max,"个字符");return"不能为空"}(e);return null}(e,r);return null!==n?e.message||n:null}var $={validate:function(e,t,r,i){if(null==e||null==e.type)return Promise.resolve();var n=e.findFieldType();if(null==n)return Promise.resolve();if("function"==typeof i)return i(e,t,r);if(null==n.validator)return Promise.resolve();var l=n.validator;return"function"==typeof l?l(e,t,r):k(l,e,t)},validateRule:S,validateRules:k},T={name:"xform-item",mixins:[g],props:{field:{type:y,default:null},validation:{type:[Boolean,Function],default:!0},labelWidth:{type:String,default:()=>v.findConfigProp("label.width")},labelPosition:{type:String,default(){var e=["left","right","top"],t=v.findConfigProp("label.position");return e.indexOf(t)>=0?t:e[0]}},behavior:{type:String,default:"builder"}},static:()=>({key:null,context:null,builder:null}),data:()=>({message:null,status:null}),computed:{isNeedValidation(){var e=this.validation;return"boolean"==typeof e&&e||"function"==typeof e},icons:()=>v.findConfigProp("icons")},methods:{getField(){var e=this.field||this.$static.context.field;return e instanceof y?e:new y(e)},getValue(){return this.$static.context.value},renderErrorMessage(){var e=this.$createElement;return null==this.message?null:e("p",{class:"xform-item-message"},[this.message])},changeMessage(e){this.message=o(e)?null:e},validate(e){if(this.isNeedValidation){var t=this.getField(),r=this.getValue();return $.validate(t,r,this,this.validation).then(()=>(this.message=null,this.status=null,!0)).catch(e=>{var t=this.parseError(e);return this.message=t,this.status="error",t})}},addField(e){if(this.isNeedValidation){var{key:t,context:r}=e,i=this.$static.builder;this.$static.key=t,this.$static.context=r,null!=i&&i.$emit("xform.builder.field.add",{key:t,validate:this.validate})}},removeField(e){var t=e.key;if(this.isNeedValidation&&t==this.$static.key){var r=this.$static.builder;null!=r&&r.$emit("xform.builder.field.remove",{key:t}),this.$static.key=null,this.$static.context=null}},parseError:e=>null==e?null:e instanceof Error?e.message:e,renderTooltip(){var e=this.$createElement;if(null==this.field||null==this.field.help||"viewer"==this.behavior)return null;var t=e("i",{class:[this.icons.builderHelp,"xform-item-help-icon"]});return"designer"==this.behavior?t:e("el-tooltip",[t,e("pre",{slot:"content",class:"xform-item-help-content"},[this.field.help])])}},render(){var e=arguments[0],t=this.getField(),r={"xform-item":!0,["xform-item-".concat(this.labelPosition)]:!0,"xform-is-required":t.required,["xform-is-".concat(this.status)]:null!=this.status},i={width:this.labelWidth};return e("div",{class:r,attrs:{"data-behavior":this.behavior}},[e("label",{class:"xform-item-label",style:i},[e("span",[t.title]),this.renderTooltip()]),e("div",{class:"xform-item-content"},[this.$slots.default,this.renderErrorMessage()])])},created(){this.$static.builder=n(this,"xform-builder"),this.isNeedValidation&&(this.$on("xform.builder.field.add",this.addField),this.$on("xform.builder.field.remove",this.removeField),this.$on("xform.builder.validate",this.validate))},destroyed(){this.isNeedValidation&&(this.$off("xform.builder.validate",this.validate),this.$off("xform.builder.field.add",this.addField),this.$off("xform.builder.field.remove",this.removeField))}};r.d(t,"components",(function(){return X})),r.d(t,"store",(function(){return v})),r.d(t,"mixin",(function(){return x})),r.d(t,"model",(function(){return b}));var X={XFormDesigner:F,XFormBuilder:E,XFormViewer:O,XFormItem:T},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.setConfig(t),Object.keys(X).forEach(t=>{var r=X[t];e.component(r.name,r)}),e.directive("xform",h)},C={name:"xForm",version:"0.4.4",install:j,use:v.use,register:v.register,store:v,mixin:x,model:b,components:X};"undefined"!=typeof window&&window.Vue&&j(window.Vue),window["__xform_shared_".concat(C.version.replace(/\./g,"_"),"__")]=C;t.default=C}]).default}));